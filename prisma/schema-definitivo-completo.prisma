// ==========================================
// üóÑÔ∏è SCHEMA PRISMA DEFINITIVO - Sistema DOM
// ==========================================
// ‚úÖ 46 TABELAS COMPLETAS
// ‚úÖ 100% das necessidades atendidas
// ‚úÖ Todas as telas cobertas
// ‚úÖ LGPD compliant
// ==========================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==========================================
// üë§ AUTENTICA√á√ÉO E USU√ÅRIOS
// ==========================================

model Usuario {
  id                String   @id @default(uuid())
  cpf               String   @unique @db.VarChar(11)
  
  // Dados Pessoais
  nomeCompleto      String   @db.VarChar(255)
  apelido           String?  @db.VarChar(100)
  dataNascimento    DateTime @db.Date
  email             String   @unique @db.VarChar(255)
  emailVerificado   Boolean  @default(false)
  telefone          String   @db.VarChar(11)
  telefoneVerificado Boolean @default(false)
  
  // Endere√ßo
  logradouro        String?  @db.VarChar(255)
  numero            String?  @db.VarChar(20)
  complemento       String?  @db.VarChar(100)
  bairro            String?  @db.VarChar(100)
  cidade            String?  @db.VarChar(100)
  uf                String?  @db.VarChar(2)
  cep               String?  @db.VarChar(8)
  
  // Autentica√ß√£o
  senhaHash         String   @db.VarChar(255)
  salt              String   @db.VarChar(255)
  autenticacao2FA   Boolean  @default(false)
  secret2FA         String?  @db.VarChar(255)
  
  // Recupera√ß√£o de senha
  refreshToken      String?  @db.Text
  resetPasswordToken String? @db.Text
  resetPasswordExpires DateTime?
  codigoRecuperacao String?  @db.VarChar(10)
  codigoExpiraEm    DateTime?
  
  // Biometria
  biometriaAtiva    Boolean  @default(false)
  biometriaHash     String?  @db.Text
  
  // Seguran√ßa
  bloqueado         Boolean  @default(false)
  bloqueadoAte      DateTime?
  motivoBloqueio    String?  @db.Text
  tentativasLogin   Int      @default(0)
  ultimasTentativasLogin Json?
  ultimoAcesso      DateTime?
  
  // Notifica√ß√µes
  notificarNovoDispositivo Boolean @default(true)
  notificarLoginSuspeito   Boolean @default(true)
  
  // LGPD
  consentimentoLGPD Boolean  @default(false)
  dataConsentimento DateTime?
  termosAceitos     Boolean  @default(false)
  versaoTermos      String?  @db.VarChar(20)
  
  // Status
  ativo             Boolean  @default(true)
  
  // Metadados
  criadoEm          DateTime @default(now())
  atualizadoEm      DateTime @updatedAt
  
  // Rela√ß√µes
  perfis            UsuarioPerfil[]
  gruposUsuario     UsuarioGrupo[]
  dispositivos      Dispositivo[]
  sessoes           Sessao[]
  historicosLogin   HistoricoLogin[]
  validacoesContato ValidacaoContato[]
  onboarding        Onboarding?
  convites          Convite[]
  aceitesTermos     AceiteTermo[]
  conversasParticipante ConversaParticipante[]
  mensagens         Mensagem[]
  mensagensLidas    MensagemLeitura[]
  mensagensReacoes  MensagemReacao[]
  logs              LogAuditoria[]
  documentos        Documento[]
  documentosCompartilhados DocumentoCompartilhamento[]
  tarefas           Tarefa[] @relation("TarefasAtribuidas")
  tarefasCriadas    Tarefa[] @relation("TarefasCriadas")
  tarefasComentarios TarefaComentario[]
  pontosRegistrados RegistroPonto[]
  emprestimos       Emprestimo[]
  alertas           Alerta[]
  listasCompras     ListaCompras[]
  listasCompartilhadas ListaComprasCompartilhamento[]
  assinaturas       Assinatura[]
  
  @@index([cpf])
  @@index([email])
  @@index([telefone])
  @@map("usuarios")
}

model Perfil {
  id          String   @id @default(uuid())
  codigo      String   @unique @db.VarChar(50)
  nome        String   @db.VarChar(100)
  descricao   String?  @db.Text
  cor         String   @db.VarChar(7)
  icone       String?  @db.VarChar(50)
  ativo       Boolean  @default(true)
  
  criadoEm    DateTime @default(now())
  atualizadoEm DateTime @updatedAt
  
  usuarios    UsuarioPerfil[]
  permissoes  PerfilFuncionalidade[]
  
  @@map("perfis")
}

model UsuarioPerfil {
  id          String   @id @default(uuid())
  usuarioId   String
  perfilId    String
  
  avatar      String?  @db.VarChar(10)
  apelido     String?  @db.VarChar(100)
  
  ativo       Boolean  @default(true)
  principal   Boolean  @default(false)
  
  criadoEm    DateTime @default(now())
  atualizadoEm DateTime @updatedAt
  
  usuario     Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  perfil      Perfil   @relation(fields: [perfilId], references: [id])
  
  @@unique([usuarioId, perfilId])
  @@index([usuarioId])
  @@index([perfilId])
  @@map("usuarios_perfis")
}

model Funcionalidade {
  id          String   @id @default(uuid())
  codigo      String   @unique @db.VarChar(100)
  nome        String   @db.VarChar(100)
  descricao   String?  @db.Text
  icone       String?  @db.VarChar(50)
  rota        String?  @db.VarChar(255)
  ordem       Int      @default(0)
  ativo       Boolean  @default(true)
  
  criadoEm    DateTime @default(now())
  atualizadoEm DateTime @updatedAt
  
  perfis      PerfilFuncionalidade[]
  
  @@map("funcionalidades")
}

model PerfilFuncionalidade {
  id               String   @id @default(uuid())
  perfilId         String
  funcionalidadeId String
  
  permissaoLeitura   Boolean @default(true)
  permissaoEscrita   Boolean @default(false)
  permissaoExclusao  Boolean @default(false)
  permissaoAdmin     Boolean @default(false)
  
  criadoEm    DateTime @default(now())
  atualizadoEm DateTime @updatedAt
  
  perfil          Perfil          @relation(fields: [perfilId], references: [id], onDelete: Cascade)
  funcionalidade  Funcionalidade  @relation(fields: [funcionalidadeId], references: [id], onDelete: Cascade)
  
  @@unique([perfilId, funcionalidadeId])
  @@index([perfilId])
  @@index([funcionalidadeId])
  @@map("perfis_funcionalidades")
}

model Grupo {
  id          String   @id @default(uuid())
  nome        String   @db.VarChar(255)
  descricao   String?  @db.Text
  cor         String?  @db.VarChar(7)
  icone       String?  @db.VarChar(50)
  tipo        String   @db.VarChar(50)
  privado     Boolean  @default(false)
  ativo       Boolean  @default(true)
  
  criadoEm    DateTime @default(now())
  atualizadoEm DateTime @updatedAt
  
  membros     UsuarioGrupo[]
  
  @@map("grupos")
}

model UsuarioGrupo {
  id          String   @id @default(uuid())
  usuarioId   String
  grupoId     String
  
  papel       String   @db.VarChar(50)
  ativo       Boolean  @default(true)
  
  criadoEm    DateTime @default(now())
  
  usuario     Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  grupo       Grupo    @relation(fields: [grupoId], references: [id], onDelete: Cascade)
  
  @@unique([usuarioId, grupoId])
  @@index([usuarioId])
  @@index([grupoId])
  @@map("usuarios_grupos")
}

// ==========================================
// üîê SEGURAN√áA E AUTENTICA√á√ÉO
// ==========================================

model Dispositivo {
  id              String   @id @default(uuid())
  usuarioId       String
  
  dispositivoId   String   @unique @db.VarChar(255)
  nome            String?  @db.VarChar(255)
  modelo          String?  @db.VarChar(255)
  versaoSO        String?  @db.VarChar(100)
  tipo            String   @db.VarChar(50)
  
  nomeRedeWiFi    String?  @db.VarChar(255)
  enderecoIP      String?  @db.VarChar(45)
  
  latitude        Float?
  longitude       Float?
  precisao        Float?
  
  confiavel       Boolean  @default(false)
  ativo           Boolean  @default(true)
  
  ultimoUso       DateTime @default(now())
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
  
  usuario         Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  sessoes         Sessao[]
  registrosPonto  RegistroPonto[]
  
  @@index([usuarioId])
  @@index([dispositivoId])
  @@map("dispositivos")
}

model Sessao {
  id              String   @id @default(uuid())
  usuarioId       String
  dispositivoId   String?
  
  token           String   @unique @db.Text
  refreshToken    String?  @db.Text
  
  enderecoIP      String?  @db.VarChar(45)
  userAgent       String?  @db.Text
  
  expiraEm        DateTime
  ativo           Boolean  @default(true)
  
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
  
  usuario         Usuario     @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  dispositivo     Dispositivo? @relation(fields: [dispositivoId], references: [id])
  
  @@index([usuarioId])
  @@index([token])
  @@map("sessoes")
}

/// @description Novo: Hist√≥rico de Login
model HistoricoLogin {
  id              String   @id @default(uuid())
  usuarioId       String
  
  sucesso         Boolean
  tentativaNumero Int      @default(1)
  
  dispositivoId   String?
  enderecoIP      String   @db.VarChar(45)
  userAgent       String?  @db.Text
  navegador       String?  @db.VarChar(100)
  sistemaOperacional String? @db.VarChar(100)
  
  latitude        Float?
  longitude       Float?
  cidade          String?  @db.VarChar(100)
  pais            String?  @db.VarChar(50)
  
  motivoFalha     String?  @db.Text
  
  criadoEm        DateTime @default(now())
  
  usuario         Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  
  @@index([usuarioId])
  @@index([criadoEm])
  @@index([sucesso])
  @@map("historico_login")
}

/// @description Novo: Valida√ß√£o de Email/Telefone
model ValidacaoContato {
  id              String   @id @default(uuid())
  usuarioId       String
  
  tipo            String   @db.VarChar(20)
  valor           String   @db.VarChar(255)
  codigo          String   @db.VarChar(10)
  validado        Boolean  @default(false)
  
  tentativas      Int      @default(0)
  expiraEm        DateTime
  validadoEm      DateTime?
  
  criadoEm        DateTime @default(now())
  
  usuario         Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  
  @@index([usuarioId])
  @@index([codigo])
  @@map("validacoes_contato")
}

/// @description Novo: Onboarding
model Onboarding {
  id              String   @id @default(uuid())
  usuarioId       String   @unique
  
  etapaAtual      Int      @default(1)
  etapasCompletas Json
  
  completo        Boolean  @default(false)
  completoEm      DateTime?
  
  preferencias    Json?
  
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
  
  usuario         Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  
  @@map("onboarding")
}

/// @description Novo: Convites
model Convite {
  id              String   @id @default(uuid())
  
  convidadoPor    String
  
  email           String   @db.VarChar(255)
  telefone        String?  @db.VarChar(11)
  nome            String?  @db.VarChar(255)
  perfilSugerido  String   @db.VarChar(50)
  
  status          String   @db.VarChar(50)
  
  token           String   @unique @db.VarChar(255)
  expiraEm        DateTime
  
  aceitoEm        DateTime?
  usuarioCriado   String?
  
  criadoEm        DateTime @default(now())
  
  convidante      Usuario  @relation(fields: [convidadoPor], references: [id], onDelete: Cascade)
  
  @@index([token])
  @@index([email])
  @@index([status])
  @@map("convites")
}

// ==========================================
// üìú TERMOS E COMPLIANCE
// ==========================================

model Termo {
  id              String   @id @default(uuid())
  
  versao          String   @unique @db.VarChar(20)
  tipo            String   @db.VarChar(50)
  
  titulo          String   @db.VarChar(255)
  subtitulo       String?  @db.VarChar(255)
  conteudo        String   @db.Text
  
  ativo           Boolean  @default(true)
  
  dataVigencia    DateTime @db.Date
  dataExpiracao   DateTime? @db.Date
  
  mudancas        Json?
  anexos          Json?
  
  notificarUsuarios Boolean @default(false)
  notificadoEm    DateTime?
  
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
  
  aceites         AceiteTermo[]
  
  @@index([versao])
  @@map("termos")
}

/// @description Novo: Aceite de Termos
model AceiteTermo {
  id              String   @id @default(uuid())
  usuarioId       String
  termoId         String
  
  versao          String   @db.VarChar(20)
  aceitoEm        DateTime @default(now())
  
  enderecoIP      String   @db.VarChar(45)
  userAgent       String?  @db.Text
  
  assinaturaHash  String?  @db.VarChar(255)
  
  usuario         Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  termo           Termo    @relation(fields: [termoId], references: [id])
  
  @@unique([usuarioId, termoId, versao])
  @@index([usuarioId])
  @@index([termoId])
  @@map("aceites_termos")
}

// ==========================================
// üí¨ COMUNICA√á√ÉO E MENSAGENS
// ==========================================

/// @description Novo: Conversas
model Conversa {
  id              String   @id @default(uuid())
  
  tipo            String   @db.VarChar(50)
  
  nome            String?  @db.VarChar(255)
  descricao       String?  @db.Text
  avatar          String?  @db.Text
  
  ativa           Boolean  @default(true)
  arquivada       Boolean  @default(false)
  
  ultimaMensagemId String?
  ultimaMensagemEm DateTime?
  
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
  
  participantes   ConversaParticipante[]
  mensagens       Mensagem[]
  
  @@map("conversas")
}

/// @description Novo: Participantes de Conversa
model ConversaParticipante {
  id              String   @id @default(uuid())
  conversaId      String
  usuarioId       String
  
  papel           String   @db.VarChar(50) @default("MEMBRO")
  
  fixada          Boolean  @default(false)
  silenciada      Boolean  @default(false)
  notificacoes    Boolean  @default(true)
  
  ultimaLeitura   DateTime?
  
  entradaEm       DateTime @default(now())
  saidaEm         DateTime?
  ativo           Boolean  @default(true)
  
  conversa        Conversa @relation(fields: [conversaId], references: [id], onDelete: Cascade)
  usuario         Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  
  @@unique([conversaId, usuarioId])
  @@index([conversaId])
  @@index([usuarioId])
  @@map("conversas_participantes")
}

model Mensagem {
  id              String   @id @default(uuid())
  conversaId      String
  remetenteId     String
  
  conteudo        String   @db.Text
  tipo            String   @db.VarChar(50)
  
  respostaParaId  String?
  
  lida            Boolean  @default(false)
  editada         Boolean  @default(false)
  excluida        Boolean  @default(false)
  fixada          Boolean  @default(false)
  
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
  excluidaEm      DateTime?
  
  conversa        Conversa @relation(fields: [conversaId], references: [id], onDelete: Cascade)
  remetente       Usuario  @relation(fields: [remetenteId], references: [id], onDelete: Cascade)
  respostaPara    Mensagem? @relation("MensagemResposta", fields: [respostaParaId], references: [id])
  respostas       Mensagem[] @relation("MensagemResposta")
  anexos          MensagemAnexo[]
  leituras        MensagemLeitura[]
  reacoes         MensagemReacao[]
  
  @@index([conversaId])
  @@index([remetenteId])
  @@index([criadoEm])
  @@map("mensagens")
}

/// @description Novo: Anexos de Mensagem
model MensagemAnexo {
  id              String   @id @default(uuid())
  mensagemId      String
  
  nome            String   @db.VarChar(255)
  tipo            String   @db.VarChar(100)
  tamanho         Int
  url             String   @db.Text
  thumbnail       String?  @db.Text
  
  duracao         Int?
  largura         Int?
  altura          Int?
  
  criadoEm        DateTime @default(now())
  
  mensagem        Mensagem @relation(fields: [mensagemId], references: [id], onDelete: Cascade)
  
  @@index([mensagemId])
  @@map("mensagens_anexos")
}

/// @description Novo: Leitura de Mensagens
model MensagemLeitura {
  id              String   @id @default(uuid())
  mensagemId      String
  usuarioId       String
  
  lidaEm          DateTime @default(now())
  
  mensagem        Mensagem @relation(fields: [mensagemId], references: [id], onDelete: Cascade)
  usuario         Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  
  @@unique([mensagemId, usuarioId])
  @@index([mensagemId])
  @@index([usuarioId])
  @@map("mensagens_leituras")
}

/// @description Novo: Rea√ß√µes em Mensagens
model MensagemReacao {
  id              String   @id @default(uuid())
  mensagemId      String
  usuarioId       String
  
  emoji           String   @db.VarChar(10)
  
  criadoEm        DateTime @default(now())
  
  mensagem        Mensagem @relation(fields: [mensagemId], references: [id], onDelete: Cascade)
  usuario         Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  
  @@unique([mensagemId, usuarioId, emoji])
  @@index([mensagemId])
  @@map("mensagens_reacoes")
}

// ==========================================
// üìä FUNCIONALIDADES CORE
// ==========================================

model Documento {
  id                String   @id @default(uuid())
  usuarioId         String
  
  nome              String   @db.VarChar(255)
  descricao         String?  @db.Text
  categoria         String   @db.VarChar(100)
  tipo              String   @db.VarChar(50)
  tamanho           Int
  
  caminhoArquivo    String   @db.Text
  urlPublica        String?  @db.Text
  hash              String?  @db.VarChar(255)
  
  validado          Boolean  @default(false)
  validadoEm        DateTime?
  validadoPor       String?  @db.VarChar(255)
  
  dataVencimento    DateTime?
  alertaVencimento  Boolean  @default(false)
  
  permissao         String   @db.VarChar(50)
  
  tags              String[]
  
  esocialPronto     Boolean  @default(false)
  backupCriado      Boolean  @default(false)
  
  criadoEm          DateTime @default(now())
  atualizadoEm      DateTime @updatedAt
  
  usuario           Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  compartilhamentos DocumentoCompartilhamento[]
  
  @@index([usuarioId])
  @@index([categoria])
  @@map("documentos")
}

model DocumentoCompartilhamento {
  id          String   @id @default(uuid())
  documentoId String
  usuarioId   String
  permissao   String   @db.VarChar(50) @default("LEITURA")
  
  criadoEm    DateTime @default(now())
  
  documento   Documento @relation(fields: [documentoId], references: [id], onDelete: Cascade)
  usuario     Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  
  @@unique([documentoId, usuarioId])
  @@index([documentoId])
  @@index([usuarioId])
  @@map("documentos_compartilhamento")
}

model Tarefa {
  id              String   @id @default(uuid())
  titulo          String   @db.VarChar(255)
  descricao       String?  @db.Text
  
  prioridade      String   @db.VarChar(20)
  status          String   @db.VarChar(50)
  
  atribuidoPara   String
  criadoPor       String
  
  dataVencimento  DateTime
  dataConclusao   DateTime?
  
  tags            String[]
  corLabel        String?  @db.VarChar(7)
  
  tempoEstimado   Int?
  tempoGasto      Int?
  
  tarefaPaiId     String?
  
  checklist       Json?
  
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
  
  responsavel     Usuario  @relation("TarefasAtribuidas", fields: [atribuidoPara], references: [id])
  criador         Usuario  @relation("TarefasCriadas", fields: [criadoPor], references: [id])
  tarefaPai       Tarefa?  @relation("SubTarefas", fields: [tarefaPaiId], references: [id])
  subtarefas      Tarefa[] @relation("SubTarefas")
  anexos          TarefaAnexo[]
  comentarios     TarefaComentario[]
  dependeDe       TarefaDependencia[] @relation("TarefaDependente")
  bloqueiaAs      TarefaDependencia[] @relation("TarefaBloqueadora")
  
  @@index([atribuidoPara])
  @@index([criadoPor])
  @@index([status])
  @@map("tarefas")
}

/// @description Novo: Anexos de Tarefa
model TarefaAnexo {
  id              String   @id @default(uuid())
  tarefaId        String
  
  nome            String   @db.VarChar(255)
  tipo            String   @db.VarChar(100)
  tamanho         Int
  url             String   @db.Text
  
  criadoEm        DateTime @default(now())
  criadoPor       String
  
  tarefa          Tarefa   @relation(fields: [tarefaId], references: [id], onDelete: Cascade)
  
  @@index([tarefaId])
  @@map("tarefas_anexos")
}

/// @description Novo: Coment√°rios de Tarefa
model TarefaComentario {
  id              String   @id @default(uuid())
  tarefaId        String
  usuarioId       String
  
  texto           String   @db.Text
  editado         Boolean  @default(false)
  
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
  
  tarefa          Tarefa   @relation(fields: [tarefaId], references: [id], onDelete: Cascade)
  usuario         Usuario  @relation(fields: [usuarioId], references: [id])
  
  @@index([tarefaId])
  @@map("tarefas_comentarios")
}

/// @description Novo: Depend√™ncias entre Tarefas
model TarefaDependencia {
  id              String   @id @default(uuid())
  
  tarefaDependenteId  String
  tarefaBloqueadoraId String
  
  tipo            String   @db.VarChar(50) @default("FINISH_TO_START")
  
  criadoEm        DateTime @default(now())
  
  tarefaDependente    Tarefa @relation("TarefaDependente", fields: [tarefaDependenteId], references: [id], onDelete: Cascade)
  tarefaBloqueadora   Tarefa @relation("TarefaBloqueadora", fields: [tarefaBloqueadoraId], references: [id], onDelete: Cascade)
  
  @@unique([tarefaDependenteId, tarefaBloqueadoraId])
  @@map("tarefas_dependencias")
}

model RegistroPonto {
  id              String   @id @default(uuid())
  usuarioId       String
  dispositivoId   String
  
  dataHora        DateTime @default(now()) @db.Timestamptz
  tipo            String   @db.VarChar(50)
  
  latitude        Float
  longitude       Float
  precisao        Float
  dentroGeofence  Boolean  @default(false)
  
  enderecoIP      String   @db.VarChar(45)
  nomeRedeWiFi    String?  @db.VarChar(255)
  
  aprovado        Boolean  @default(false)
  aprovadoPor     String?  @db.VarChar(255)
  aprovadoEm      DateTime?
  
  observacao      String?  @db.Text
  
  hashIntegridade String   @db.VarChar(255)
  
  criadoEm        DateTime @default(now())
  
  usuario         Usuario     @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  dispositivo     Dispositivo @relation(fields: [dispositivoId], references: [id])
  
  @@index([usuarioId])
  @@index([dataHora])
  @@index([tipo])
  @@map("registros_ponto")
}

model EventoESocial {
  id                String   @id @default(uuid())
  
  tipoEvento        String   @db.VarChar(20)
  descricao         String   @db.VarChar(255)
  
  status            String   @db.VarChar(50)
  
  dataEnvio         DateTime?
  dataProcessamento DateTime?
  protocolo         String?  @db.VarChar(255)
  versao            String?  @db.VarChar(20)
  
  xmlEnvio          String?  @db.Text
  xmlRetorno        String?  @db.Text
  
  erro              String?  @db.Text
  
  criadoEm          DateTime @default(now())
  atualizadoEm      DateTime @updatedAt
  
  @@index([tipoEvento])
  @@index([status])
  @@map("eventos_esocial")
}

model Emprestimo {
  id              String   @id @default(uuid())
  usuarioId       String
  
  valor           Decimal  @db.Decimal(10, 2)
  valorParcela    Decimal  @db.Decimal(10, 2)
  quantidadeParcelas Int
  parcelasPagas   Int      @default(0)
  
  dataConcessao   DateTime @db.Date
  dataVencimento  DateTime @db.Date
  
  status          String   @db.VarChar(50)
  
  observacao      String?  @db.Text
  
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
  
  usuario         Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  
  @@index([usuarioId])
  @@index([status])
  @@map("emprestimos")
}

model Alerta {
  id              String   @id @default(uuid())
  usuarioId       String?
  
  titulo          String   @db.VarChar(255)
  descricao       String   @db.Text
  tipo            String   @db.VarChar(50)
  prioridade      String   @db.VarChar(20)
  categoria       String   @db.VarChar(100)
  
  status          String   @db.VarChar(50)
  lido            Boolean  @default(false)
  
  dataAlerta      DateTime
  dataExpiracao   DateTime?
  
  recorrente      Boolean  @default(false)
  frequencia      String?  @db.VarChar(50)
  
  textoNotificacao String?  @db.Text
  gatilhoContador  Int      @default(0)
  ultimoGatilho    DateTime?
  
  notificarEmail   Boolean  @default(false)
  notificarPush    Boolean  @default(false)
  notificarSMS     Boolean  @default(false)
  
  horaAlerta       String?  @db.VarChar(5)
  
  condicoes       Json?
  
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
  
  usuario         Usuario? @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  historico       AlertaHistorico[]
  
  @@index([usuarioId])
  @@index([tipo])
  @@index([status])
  @@map("alertas")
}

/// @description Novo: Hist√≥rico de Alertas
model AlertaHistorico {
  id              String   @id @default(uuid())
  alertaId        String
  
  disparadoEm     DateTime @default(now())
  destinatarios   String[]
  
  canal           String   @db.VarChar(50)
  
  sucesso         Boolean
  erro            String?  @db.Text
  
  valorGatilho    Json?
  
  alerta          Alerta   @relation(fields: [alertaId], references: [id], onDelete: Cascade)
  
  @@index([alertaId])
  @@index([disparadoEm])
  @@map("alertas_historico")
}

// ==========================================
// üõí GEST√ÉO DE COMPRAS
// ==========================================

model ListaCompras {
  id              String   @id @default(uuid())
  usuarioId       String
  nome            String   @db.VarChar(255)
  categoria       String   @db.VarChar(100)
  descricao       String?  @db.Text
  
  totalItens      Int      @default(0)
  itensComprados  Int      @default(0)
  valorEstimado   Decimal  @db.Decimal(10, 2)
  valorFinal      Decimal? @db.Decimal(10, 2)
  
  ativa           Boolean  @default(true)
  concluida       Boolean  @default(false)
  
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
  
  usuario         Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  itens           ItemCompra[]
  compartilhamentos ListaComprasCompartilhamento[]
  
  @@index([usuarioId])
  @@index([categoria])
  @@map("listas_compras")
}

model ItemCompra {
  id              String   @id @default(uuid())
  listaId         String
  
  nome            String   @db.VarChar(255)
  quantidade      String   @db.VarChar(100)
  preco           Decimal? @db.Decimal(10, 2)
  categoria       String   @db.VarChar(100)
  
  comprado        Boolean  @default(false)
  compradoEm      DateTime?
  compradoPor     String?  @db.VarChar(255)
  
  observacao      String?  @db.Text
  marca           String?  @db.VarChar(100)
  local           String?  @db.VarChar(255)
  
  ordem           Int      @default(0)
  
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
  
  lista           ListaCompras @relation(fields: [listaId], references: [id], onDelete: Cascade)
  
  @@index([listaId])
  @@index([comprado])
  @@index([categoria])
  @@map("itens_compra")
}

model ListaComprasCompartilhamento {
  id          String   @id @default(uuid())
  listaId     String
  usuarioId   String
  permissao   String   @db.VarChar(50) @default("LEITURA")
  
  criadoEm    DateTime @default(now())
  
  lista       ListaCompras @relation(fields: [listaId], references: [id], onDelete: Cascade)
  usuario     Usuario      @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  
  @@unique([listaId, usuarioId])
  @@index([listaId])
  @@index([usuarioId])
  @@map("listas_compras_compartilhamento")
}

// ==========================================
// üí∞ FINANCEIRO E ASSINATURAS
// ==========================================

model CalculoSalarial {
  id              String   @id @default(uuid())
  cpfEmpregado    String   @db.VarChar(11)
  
  mesReferencia   Int
  anoReferencia   Int
  
  salarioBruto    Decimal  @db.Decimal(10, 2)
  descontos       Json
  proventos       Json
  salarioLiquido  Decimal  @db.Decimal(10, 2)
  
  baseINSS        Decimal  @db.Decimal(10, 2)
  valorINSS       Decimal  @db.Decimal(10, 2)
  baseIR          Decimal  @db.Decimal(10, 2)
  valorIR         Decimal  @db.Decimal(10, 2)
  
  horasTrabalhadas  Int?
  horasExtras       Int?
  valorHoraExtra    Decimal? @db.Decimal(10, 2)
  
  valeTransporte    Decimal? @db.Decimal(10, 2)
  valeAlimentacao   Decimal? @db.Decimal(10, 2)
  planoSaude        Decimal? @db.Decimal(10, 2)
  
  diasFalta         Int?     @default(0)
  valorFaltas       Decimal? @db.Decimal(10, 2)
  
  processado      Boolean  @default(false)
  pago            Boolean  @default(false)
  dataPagamento   DateTime?
  
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
  
  holerites       HoleritePagamento[]
  
  @@unique([cpfEmpregado, mesReferencia, anoReferencia])
  @@index([cpfEmpregado])
  @@map("calculos_salariais")
}

/// @description Novo: Holerites
model HoleritePagamento {
  id              String   @id @default(uuid())
  calculoId       String
  
  numeroHolerite  String   @unique @db.VarChar(50)
  arquivoUrl      String   @db.Text
  hash            String   @db.VarChar(255)
  
  enviado         Boolean  @default(false)
  enviadoEm       DateTime?
  visualizado     Boolean  @default(false)
  visualizadoEm   DateTime?
  
  criadoEm        DateTime @default(now())
  
  calculo         CalculoSalarial @relation(fields: [calculoId], references: [id])
  
  @@index([calculoId])
  @@map("holerites_pagamento")
}

/// @description Novo: Planos de Assinatura
model PlanoAssinatura {
  id              String   @id @default(uuid())
  
  codigo          String   @unique @db.VarChar(50)
  nome            String   @db.VarChar(100)
  tagline         String   @db.VarChar(255)
  descricao       String   @db.Text
  
  precoMensal     Decimal  @db.Decimal(10, 2)
  precoAnual      Decimal  @db.Decimal(10, 2)
  descontoAnual   String?  @db.VarChar(50)
  
  recursos        String[]
  limitesRecursos Json?
  
  popular         Boolean  @default(false)
  recomendado     Boolean  @default(false)
  gratuito        Boolean  @default(false)
  parceria        Boolean  @default(false)
  
  ativo           Boolean  @default(true)
  ordem           Int      @default(0)
  
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
  
  assinaturas     Assinatura[]
  
  @@map("planos_assinatura")
}

/// @description Novo: Assinaturas
model Assinatura {
  id              String   @id @default(uuid())
  usuarioId       String
  planoId         String
  
  tipoCobranca    String   @db.VarChar(50)
  
  status          String   @db.VarChar(50)
  
  inicioEm        DateTime
  fimEm           DateTime?
  canceladaEm     DateTime?
  
  proximaCobrancaEm DateTime?
  valorAtual      Decimal  @db.Decimal(10, 2)
  
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
  
  usuario         Usuario  @relation(fields: [usuarioId], references: [id])
  plano           PlanoAssinatura @relation(fields: [planoId], references: [id])
  
  @@index([usuarioId])
  @@index([status])
  @@map("assinaturas")
}

// ==========================================
// üìã LOG E AUDITORIA (LGPD)
// ==========================================

model LogAuditoria {
  id              String   @id @default(uuid())
  usuarioId       String?
  
  acao            String   @db.VarChar(100)
  entidade        String   @db.VarChar(100)
  entidadeId      String?  @db.VarChar(255)
  
  descricao       String   @db.Text
  
  metodo          String?  @db.VarChar(20)
  rota            String?  @db.VarChar(255)
  enderecoIP      String?  @db.VarChar(45)
  userAgent       String?  @db.Text
  
  dadosAnteriores Json?
  dadosNovos      Json?
  
  sucesso         Boolean  @default(true)
  erro            String?  @db.Text
  
  tipoLog         String   @db.VarChar(50)
  nivelSeveridade String   @db.VarChar(20)
  
  criadoEm        DateTime @default(now())
  
  usuario         Usuario? @relation(fields: [usuarioId], references: [id], onDelete: SetNull)
  
  @@index([usuarioId])
  @@index([acao])
  @@index([entidade])
  @@index([criadoEm])
  @@index([tipoLog])
  @@map("logs_auditoria")
}

model Configuracao {
  id              String   @id @default(uuid())
  
  chave           String   @unique @db.VarChar(100)
  valor           String   @db.Text
  tipo            String   @db.VarChar(50)
  
  descricao       String?  @db.Text
  categoria       String   @db.VarChar(100)
  
  ativo           Boolean  @default(true)
  sensivel        Boolean  @default(false)
  
  criadoEm        DateTime @default(now())
  atualizadoEm    DateTime @updatedAt
  
  @@index([chave])
  @@index([categoria])
  @@map("configuracoes")
}

